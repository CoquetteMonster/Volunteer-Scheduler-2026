<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Volunteer Scheduler (Cloud)</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; background:#f5f7fa; padding:20px; }
.container { max-width:900px; margin:auto; background:white; padding:20px; border-radius:10px; }
input,button{ padding:8px; margin:5px 0; width:100%; }
button{ background:#4CAF50; color:white; border:none; cursor:pointer; }
button:hover{ background:#45a049; }
#output{ background:#eef; padding:10px; height:180px; overflow:auto; white-space:pre-line; }
</style>
</head>

<body>

<div class="container">

<h2>Volunteer Scheduler (Cloud Saving)</h2>

<label>Upload Volunteers CSV:</label>
<input type="file" id="csvFile" accept=".csv">

<label>Event Name:</label>
<input type="text" id="eventName">

<label>Start Time (hour):</label>
<input type="number" id="startTime">

<label>Duration (hours):</label>
<input type="number" id="duration">

<label>Volunteers Needed:</label>
<input type="number" id="required">

<button onclick="allocate()">Allocate Volunteers</button>
<button onclick="showGantt()">Show Gantt Chart</button>

<h3>Output</h3>
<div id="output"></div>

<canvas id="chart"></canvas>

</div>

<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
  getFirestore, doc, setDoc, getDoc
} from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

//////////////////////////////////////////////////
// ðŸ”¥ YOUR FIREBASE CONFIG
//////////////////////////////////////////////////

const firebaseConfig = {
  apiKey: "PASTE_YOUR_REAL_KEY_HERE",
  authDomain: "volunteer-scheduler-2026.firebaseapp.com",
  projectId: "volunteer-scheduler-2026",
  storageBucket: "volunteer-scheduler-2026.appspot.com",
  messagingSenderId: "633471656395",
  appId: "1:633471656395:web:98eeb940e94b4fd4eb164e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

//////////////////////////////////////////////////
// DATA
//////////////////////////////////////////////////

let volunteers = [];
let chart = null;

//////////////////////////////////////////////////
// LOAD CSV
//////////////////////////////////////////////////

document.getElementById("csvFile").addEventListener("change", e => {

  const file = e.target.files[0];
  const reader = new FileReader();

  reader.onload = evt => {

    const lines = evt.target.result.trim().split("\n");
    volunteers = [];

    for (let i = 1; i < lines.length; i++) {

      const cols = lines[i].split(",");
      const reg_no = cols[0]?.trim();
      const name = cols[1]?.trim() || "Unknown";

      if (reg_no) {
        volunteers.push({
          reg_no,
          name,
          next_available: 0,
          tasks: []
        });
      }
    }

    document.getElementById("output").innerText =
      `Loaded ${volunteers.length} volunteers`;

    saveToCloud();
  };

  reader.readAsText(file);
});

//////////////////////////////////////////////////
// SAVE TO CLOUD
//////////////////////////////////////////////////

async function saveToCloud() {

  const logs =
    document.getElementById("output").innerText;

  await setDoc(doc(db, "scheduler", "main"), {
    volunteers,
    logs
  });
}

//////////////////////////////////////////////////
// LOAD FROM CLOUD
//////////////////////////////////////////////////

async function loadFromCloud() {

  const snap =
    await getDoc(doc(db, "scheduler", "main"));

  if (snap.exists()) {

    const data = snap.data();

    volunteers = data.volunteers || [];
    document.getElementById("output").innerText =
      data.logs || "";
  }
}

//////////////////////////////////////////////////
// ALLOCATION
//////////////////////////////////////////////////

window.allocate = function() {

  const eventName =
    document.getElementById("eventName").value;

  const start =
    parseInt(document.getElementById("startTime").value);

  const duration =
    parseInt(document.getElementById("duration").value);

  const required =
    parseInt(document.getElementById("required").value);

  let assigned = 0;
  let result =
    `Assigned Volunteers for '${eventName}':\n`;

  for (let v of volunteers) {

    if (assigned >= required) break;

    if (v.next_available <= start) {

      let work = Math.min(duration, 2);
      let end = start + work;

      v.next_available = end + 1;

      v.tasks.push({ start, duration: work, event: eventName });

      result += `${v.reg_no} â€” ${v.name}\n`;
      assigned++;
    }
  }

  if (assigned < required)
    result += "âš  Not enough volunteers available!";

  document.getElementById("output").innerText = result;

  saveToCloud();
};

//////////////////////////////////////////////////
// GANTT CHART
//////////////////////////////////////////////////

window.showGantt = function() {

  const datasets = [];

  volunteers.forEach(v => {
    v.tasks.forEach(t => {
      datasets.push({
        label: `${v.name} (${v.reg_no})`,
        data: [{
          x: [t.start, t.start + t.duration],
          y: `${v.name} (${v.reg_no})`
        }]
      });
    });
  });

  const ctx = document.getElementById("chart").getContext("2d");

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "bar",
    data: { datasets },
    options: {
      indexAxis: 'y',
      plugins: { legend: { display:false } }
    }
  });
};

//////////////////////////////////////////////////
// LOAD SAVED DATA ON PAGE OPEN
//////////////////////////////////////////////////

loadFromCloud();

</script>

</body>
</html>
